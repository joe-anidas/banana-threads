{%- style -%}
  .drawer {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100%;
    display: flex;
    justify-content: flex-end;
    background-color: rgba(0, 0, 0, 0.5);
    transition: visibility 0s, opacity 0.3s ease;
    visibility: hidden;
    opacity: 0;
  }

  .drawer.active {
    visibility: visible;
    opacity: 1;
  }

  .drawer__inner {
    height: 100%;
    width: 100%;
    max-width: 430px;
    overflow-y: auto;
    background-color: rgb(var(--color-background));
    transform: translateX(100%);
    transition: transform 0.3s ease;
    display: flex;
    flex-direction: column;
  }

  .drawer.active .drawer__inner {
    transform: translateX(0);
  }

  .drawer__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    background-color: rgb(var(--color-background));
    position: sticky;
    top: 0;
    z-index: 2;
    border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
  }

  .drawer__heading {
    margin: 0;
    font-size: 1.2rem;
  }

  .drawer__close {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: transparent;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
  }

  .cart-drawer__warnings {
    padding: 1.5rem;
  }

  #CartDrawer {
    overflow: hidden;
  }
  
  /* Cart items list */
  .cart-drawer-items {
    flex-grow: 1;
    overflow-y: auto;
    padding: 1rem;
  }
  
  /* Empty cart styles */
  .drawer__inner-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    padding: 2rem;
    text-align: center;
  }
  
  .drawer__inner-empty p {
    margin-bottom: 2rem;
  }
  
  /* Cart footer styles */
  .cart-drawer__footer {
    padding: 1rem 1.5rem 1.5rem;
    background-color: rgb(var(--color-background));
    position: sticky;
    bottom: 0;
    z-index: 2;
    border-top: 1px solid rgba(var(--color-foreground), 0.1);
  }
  
  .cart-drawer__footer > details {
    margin-top: 1rem;
  }
  
  .cart-drawer__footer .button {
    width: 100%;
  }
  
  /* Cart item styles */
  .cart-item {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 1rem;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
  }
  
  .cart-item__image {
    width: 80px;
    height: 80px;
    object-fit: cover;
  }
  
  .cart-item__name {
    font-weight: 500;
  }
  
  .cart-item__price {
    font-weight: bold;
  }
  
  .cart-item__quantity {
    max-width: 80px;
    margin-top: 0.5rem;
  }
  
  .cart-item__remove-button {
    background: none;
    border: none;
    cursor: pointer;
    color: rgba(var(--color-foreground), 0.6);
    align-self: start;
    padding: 0;
  }
  
  /* Overlay */
  #CartDrawer-Overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
  }
  
  /* Responsive */
  @media screen and (max-width: 749px) {
    .drawer__inner {
      max-width: 100%;
    }
  }
{%- endstyle -%}

<script src="{{ 'cart-drawer.js' | asset_url }}" defer="defer"></script>

<cart-drawer class="drawer">
  <div class="drawer__inner">
    <div class="drawer__header">
      <h2 class="drawer__heading">{{ 'sections.cart.title' | t }}</h2>
      <button class="drawer__close" aria-label="{{ 'accessibility.close' | t }}" type="button">
        {% render 'icon-close' %}
      </button>
    </div>
    <div id="CartDrawer-CartItems">
      <div class="drawer__inner-empty">
        <div id="CartDrawer-LiveRegionText" class="visually-hidden" role="status"></div>
        <div id="CartDrawer-LineItemStatus" class="visually-hidden" aria-hidden="true">{{ 'accessibility.loading' | t }}</div>
        <cart-drawer-items class="cart-drawer-items">
          {% if cart != empty %}
            <div class="cart-items">
              <table class="cart-items">
                <caption class="visually-hidden">{{ 'sections.cart.title' | t }}</caption>
                <thead>
                  <tr>
                    <th class="caption-with-letter-spacing" colspan="2" scope="col">{{ 'sections.cart.headings.product' | t }}</th>
                    <th class="right caption-with-letter-spacing" scope="col">{{ 'sections.cart.headings.price' | t }}</th>
                    <th class="cart-items__heading--wide caption-with-letter-spacing" scope="col">{{ 'sections.cart.headings.quantity' | t }}</th>
                    <th class="right caption-with-letter-spacing" scope="col">{{ 'sections.cart.headings.total' | t }}</th>
                  </tr>
                </thead>
      
                <tbody>
                  {%- for item in cart.items -%}
                    <tr class="cart-item" id="CartDrawer-Item-{{ forloop.index }}">
                      <td class="cart-item__media">
                        {% if item.image %}
                          <img
                            class="cart-item__image"
                            src="{{ item.image | image_url: width: 150 }}"
                            alt="{{ item.image.alt | escape }}"
                            loading="lazy"
                            width="150"
                            height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
                          >
                        {% endif %}
                      </td>
                      <td class="cart-item__details">
                        <a href="{{ item.url }}" class="cart-item__name break">{{ item.product.title | escape }}</a>
                        {%- if item.product.has_only_default_variant == false -%}
                          <p class="product-option">{{ item.variant.title }}</p>
                        {%- endif -%}
                        <p class="cart-item__price">
                          {%- if item.original_price != item.final_price -%}
                            <span class="cart-item__old-price">{{ item.original_price | money }}</span>
                          {%- endif -%}
                          {{ item.final_price | money }}
                        </p>
                      </td>
                      <td class="cart-item__quantity">
                        <div class="quantity">
                          <label class="visually-hidden" for="CartDrawer-Quantity-{{ forloop.index }}">
                            {{ 'products.product.quantity.label' | t }}
                          </label>
                          <input
                            class="quantity__input"
                            type="number"
                            name="updates[]"
                            id="CartDrawer-Quantity-{{ forloop.index }}"
                            data-index="{{ forloop.index }}"
                            min="0"
                            value="{{ item.quantity }}"
                          >
                          <div id="CartDrawer-Spinner-{{ item.key }}" class="loading-overlay__spinner hidden">
                            <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                              <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                            </svg>
                          </div>
                        </div>
                      </td>
                      <td class="cart-item__totals right">
                        <cart-remove-button
                          id="CartDrawer-Remove-{{ forloop.index }}"
                          data-index="{{ forloop.index }}"
                        >
                          <button class="cart-item__remove-button" aria-label="{{ 'sections.cart.remove_item' | t: product: item.product.title }}">
                            {% render 'icon-remove' %}
                          </button>
                          <div id="CartDrawer-Spinner-{{ item.key }}" class="loading-overlay__spinner hidden">
                            <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                              <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                            </svg>
                          </div>
                        </cart-remove-button>
                      </td>
                    </tr>
                  {%- endfor -%}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="drawer__inner-empty">
              <h2 class="cart__empty-text">{{ 'sections.cart.empty' | t }}</h2>
              <p>{{ 'sections.cart.browse' | t }}</p>
              <a href="{{ routes.all_products_collection_url }}" class="button">
                {{ 'general.continue_shopping' | t }}
              </a>
            </div>
          {% endif %}
        </cart-drawer-items>
      </div>
    </div>
    
    {% if cart != empty %}
      <div class="cart-drawer__footer">
        <div class="totals" role="status">
          <h2 class="totals__total">{{ 'sections.cart.subtotal' | t }}</h2>
          <p class="totals__total-value">{{ cart.total_price | money_with_currency }}</p>
        </div>
        <div>
          {%- if settings.cart_notes_enable -%}
            <details>
              <summary>
                <span class="totals__total">{{ 'sections.cart.note' | t }}</span>
                {% render 'icon-caret' %}
              </summary>
              <cart-note class="cart__note">
                <label for="CartDrawer-Note">{{ 'sections.cart.note' | t }}</label>
                <textarea id="CartDrawer-Note" name="note" class="cart-note__input">{{ cart.note }}</textarea>
              </cart-note>
            </details>
          {%- endif -%}
        </div>
        
        <a href="{{ routes.cart_url }}" class="button button--primary button--full-width">
          {{ 'sections.cart.checkout' | t }}
        </a>
        <div id="CartDrawer-CartErrors" role="alert"></div>
      </div>
    {% endif %}
  </div>
  
  <div id="CartDrawer-Overlay" class="drawer__overlay"></div>
</cart-drawer>
