{%- if cart != empty and cart.items.size > 0 -%}
  {%- assign current_product = cart.items.first.product -%}
  {%- assign current_collection = null -%}
  
  {%- for collection in current_product.collections -%}
    {%- if current_collection == null -%}
      {%- assign current_collection = collection -%}
    {%- endif -%}
  {%- endfor -%}

  {%- if current_collection != null -%}
    <div class="cart-drawer-upskill">
      <h3 class="cart-drawer-upskill__heading">{{ section.settings.heading }}</h3>
      <ul class="cart-drawer-upskill__grid" role="list">
        {%- assign products_to_show = 0 -%}
        {%- for product in current_collection.products limit: 8 -%}
          {%- if product.id != current_product.id and products_to_show < 2 -%}
            {%- assign products_to_show = products_to_show | plus: 1 -%}
            {%- assign first_available_variant = product.first_available_variant -%}
            {%- if first_available_variant -%}
              <li class="cart-drawer-upskill__item">
                <div class="cart-drawer-upskill__image-container">
                  <a href="{{ product.url }}" class="cart-drawer-upskill__link">
                    <img
                      srcset="{% if product.featured_media.width >= 165 %}{{ product.featured_media | image_url: width: 165 }} 165w,{% endif %}
                        {% if product.featured_media.width >= 360 %}{{ product.featured_media | image_url: width: 360 }} 360w,{% endif %}"
                      src="{{ product.featured_media | image_url: width: 165 }}"
                      sizes="(min-width: 1200px) 165px, (min-width: 990px) 138px, (min-width: 750px) 165px, 138px"
                      alt="{{ product.featured_media.alt | escape }}"
                      class="cart-drawer-upskill__image"
                      loading="lazy"
                      width="{{ product.featured_media.width }}"
                      height="{{ product.featured_media.height }}"
                    >
                  </a>
                  <button 
                    class="cart-drawer-upskill__add-button" 
                    type="button"
                    data-product-id="{{ product.id }}"
                    data-variant-id="{{ first_available_variant.id }}"
                    aria-label="{{ 'products.product.add_to_cart' | t }}"
                  >
                    <span class="svg-wrapper">
                      {{- 'icon-plus.svg' | inline_asset_content -}}
                    </span>
                  </button>
                </div>
                <h4 class="cart-drawer-upskill__product-title">
                  <a href="{{ product.url }}">{{ product.title }}</a>
                </h4>
                <div class="cart-drawer-upskill__product-price">
                  {%- if first_available_variant.compare_at_price > first_available_variant.price -%}
                    <span class="visually-hidden">{{ 'products.product.price.regular_price' | t }}</span>
                    <s>{{ first_available_variant.compare_at_price | money }}</s>
                    <span class="visually-hidden">{{ 'products.product.price.sale_price' | t }}</span>
                    <span>{{ first_available_variant.price | money }}</span>
                  {%- else -%}
                    <span>{{ first_available_variant.price | money }}</span>
                  {%- endif -%}
                </div>
              </li>
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
      </ul>
    </div>
  {%- endif -%}
{%- endif -%}

{% schema %}
{
  "name": "Cart Upskill",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "default": "You might also like",
      "label": "Heading"
    }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "Cart Upskill",
      "category": "Promotional"
    }
  ]
}
{% endschema %} 